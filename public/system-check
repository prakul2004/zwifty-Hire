<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Zwifty | System Check</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="check.css">
</head>

<body>

<script>
/* ğŸ” AUTH CHECK */
if (localStorage.getItem("loggedIn") !== "true") {
  window.location.href = "login.html";
}

/* ğŸš« BLOCK MOBILE DEVICES */
if (/Mobi|Android|iPhone/i.test(navigator.userAgent)) {
  alert("Mobile devices are not allowed. Please use a laptop or desktop.");
  window.location.href = "login.html";
}
</script>

<div class="check-wrapper">
  <div class="check-card">

    <h1>System Readiness & Instructions</h1>

    <ul class="instructions">
      <li>You must be alone in the room</li>
      <li>Webcam and microphone must remain enabled</li>
      <li>Mobile phones are strictly prohibited</li>
      <li>Do not switch tabs or minimize the browser</li>
      <li>Multiple violations will auto-submit the assessment</li>
    </ul>

    <div class="status">
      <p id="camStatus">ğŸ“· Camera: Checking...</p>
      <p id="micStatus">ğŸ¤ Microphone: Checking...</p>
      <p id="fsStatus">ğŸ–¥ Fullscreen: Required</p>
    </div>

    <button id="startBtn" disabled onclick="startAssessment()">
      Start Assessment
    </button>

  </div>
</div>

<script>
/* ğŸ” AUTH CHECK */
if (localStorage.getItem("loggedIn") !== "true") {
  window.location.href = "login.html";
}

/* ğŸš« BLOCK MOBILE */
if (/Mobi|Android|iPhone/i.test(navigator.userAgent)) {
  alert("Mobile devices are not allowed.");
  window.location.href = "login.html";
}

let camOk = false;
let micOk = false;

/* ğŸ¥ CAMERA + MIC CHECK */
async function checkDevices() {
  try {
    const stream = await navigator.mediaDevices.getUserMedia({
      video: true,
      audio: true
    });

    stream.getTracks().forEach(t => t.stop());

    camOk = true;
    micOk = true;

    document.getElementById("camStatus").innerText = "ğŸ“· Camera: Ready";
    document.getElementById("micStatus").innerText = "ğŸ¤ Microphone: Ready";

    // âœ… ENABLE START BUTTON NOW
    document.getElementById("startBtn").disabled = false;

  } catch (err) {
    alert("Camera and microphone access is mandatory.");
  }
}

/* â–¶ START EXAM */
async function startAssessment() {
  if (!camOk || !micOk) {
    alert("Camera & microphone must be enabled.");
    return;
  }

  try {
    await document.documentElement.requestFullscreen();
  } catch {
    alert("Fullscreen permission is required.");
    return;
  }

  localStorage.setItem("systemCheckPassed", "true");
  window.location.href = "exam.html";
}

/* INIT */
checkDevices();
</script>


</body>
</html>
